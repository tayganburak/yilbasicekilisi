<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="UTF-8">
    <title>Untitled</title>
    

  </head>
    
  <body>
  <!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>YÄ±lbaÅŸÄ± Ã‡ekiliÅŸi</title>
  <style>
    body { font-family: Arial; background:#f2f2f2; display:flex; justify-content:center; padding:40px; }
    .box { background:white; padding:20px; border-radius:12px; width:360px; text-align:center; box-shadow:0 0 10px rgba(0,0,0,.1); }
    button { padding:10px 18px; border:none; border-radius:10px; background:#40916c; color:white; cursor:pointer; }
    .adminBtn { background:#6c757d; margin-top:20px; }
    #result { margin-top:20px; font-size:1.2rem; font-weight:bold; }
    select { width:100%; padding:10px; border-radius:8px; border:1px solid #ccc; }
  </style>
</head>

<body>
<div class="box">
  <h2>YÄ±lbaÅŸÄ± Ã‡ekiliÅŸi</h2>
  <p>Ä°smini seÃ§ ve eÅŸleÅŸmeni gÃ¶r.</p>

  <select id="nameSelect">
    <option value="">Ä°smini seÃ§</option>
    <option>Damla</option>
    <option>BarÄ±ÅŸ</option>
    <option>Burak KasÄ±rga</option>
    <option>Burak Taygan</option>
    <option>BÃ¼ÅŸra</option>
    <option>Hakan</option>
    <option>Semih</option>
    <option>Okan</option>
    <option>DoÄŸan</option>
    <option>Åeyda</option>
    <option>Fuat</option>
    <option>RÃ¼stem</option>
    <option>Ã–zge</option>
    <option>Gizem</option>
    <option>Erkan</option>
    <option>NeÅŸe</option>
    <option>BaÅŸak</option>
  </select>

  <br><br>
  <button id="showResultBtn">Sonucu GÃ¶ster</button>

  <div id="result"></div>

  <button id="adminBtn" class="adminBtn">Admin: EÅŸleÅŸmeleri SÄ±fÄ±rla</button>
</div>

<script type="module">
  // -----------------------------
  // Firebase v12 ModÃ¼l Import
  // -----------------------------
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
  import { getFirestore, doc, setDoc } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-firestore.js";

  // Firebase Config
  const firebaseConfig = {
    apiKey: "AIzaSyCwhEDuHLFEqKXS0Nt2DOTxLpiqomDV3ZA",
    authDomain: "yilbasison.firebaseapp.com",
    projectId: "yilbasison",
    storageBucket: "yilbasison.firebasestorage.app",
    messagingSenderId: "548976271380",
    appId: "1:548976271380:web:815f2afc62dc9ae7b6c701",
    measurementId: "G-N8D8V7N1K8"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  // -----------------------------
  // Ä°sim listesi
  // -----------------------------
  const NAMES = [
    "Damla","BarÄ±ÅŸ","Burak KasÄ±rga","Burak Taygan","BÃ¼ÅŸra","Hakan","Semih","Okan",
    "DoÄŸan","Åeyda","Fuat","RÃ¼stem","Ã–zge","Gizem","Erkan","NeÅŸe","BaÅŸak"
  ];

  // -----------------------------
  // Derangement Fonksiyonu
  // -----------------------------
  function createDerangement(list) {
    let arr = [...list];
    let shuffled = [...list];

    do {
      for (let i = shuffled.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
      }
    } while (arr.some((v,i) => v === shuffled[i]));

    let map = {};
    arr.forEach((name,i) => map[name] = shuffled[i]);
    return map;
  }

  if (!localStorage.getItem("MATCH_TABLE")) {
    localStorage.setItem("MATCH_TABLE", JSON.stringify(createDerangement(NAMES)));
  }

  let MATCH_TABLE = JSON.parse(localStorage.getItem("MATCH_TABLE"));
  let lockedUser = localStorage.getItem("LOCKED_USER");

  // -----------------------------
  // Sonucu GÃ¶ster Fonksiyonu
  // -----------------------------
  async function showResult() {
    const user = document.getElementById("nameSelect").value;
    const result = document.getElementById("result");

    if (!user) { result.innerHTML = "LÃ¼tfen ismini seÃ§."; return; }
    if (lockedUser && lockedUser !== user) {
      result.innerHTML = `Bu cihaz daha Ã¶nce <b>${lockedUser}</b> iÃ§in kullanÄ±ldÄ±.`; 
      return;
    }

    lockedUser = user;
    localStorage.setItem("LOCKED_USER", user);

    const match = MATCH_TABLE[user];

    // Firebase Firestore kaydÄ±
    await setDoc(doc(db, "cekilis_sonuclari", user), {
      isim: user,
      hediyeVerdigi: match,
      zaman: Date.now()
    });

    result.innerHTML = `Bu yÄ±l hediye vereceÄŸin kiÅŸi:<br><br>ğŸ <b>${match}</b> ğŸ`;
  }

  // -----------------------------
  // Admin Reset Fonksiyonu
  // -----------------------------
  function adminReset() {
    const pass = prompt("Admin ÅŸifresi:");
    if (pass !== "258963") { alert("HatalÄ± ÅŸifre!"); return; }

    localStorage.removeItem("MATCH_TABLE");
    localStorage.removeItem("LOCKED_USER");

    alert("EÅŸleÅŸmeler sÄ±fÄ±rlandÄ±.");
    location.reload();
  }

  // -----------------------------
  // Event Listener'lar
  // -----------------------------
  document.getElementById("showResultBtn").addEventListener("click", showResult);
  document.getElementById("adminBtn").addEventListener("click", adminReset);

</script>
</body>
</html>
    
  </body>
  
</html>
