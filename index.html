<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="UTF-8">
    <title>Untitled</title>
    

  </head>
    
  <body>
  <!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>YÄ±lbaÅŸÄ± Ã‡ekiliÅŸi</title>
  <style>
    body { font-family: Arial; background:#f2f2f2; display:flex; justify-content:center; padding:40px; }
    .box { background:white; padding:20px; border-radius:12px; width:360px; text-align:center; box-shadow:0 0 10px rgba(0,0,0,.1); }
    button { padding:10px 18px; border:none; border-radius:10px; background:#40916c; color:white; cursor:pointer; }
    .adminBtn { background:#6c757d; margin-top:20px; }
    #result { margin-top:20px; font-size:1.2rem; font-weight:bold; }
    select { width:100%; padding:10px; border-radius:8px; border:1px solid #ccc; }
  </style>
</head>

<body>
<div class="box">
  <h2>YÄ±lbaÅŸÄ± Ã‡ekiliÅŸi</h2>
  <p>Ä°smini seÃ§ ve eÅŸleÅŸmeni gÃ¶r.</p>

  <select id="nameSelect">
    <option value="">Ä°smini seÃ§</option>
    <option>Damla</option>
    <option>BarÄ±ÅŸ</option>
    <option>Burak KasÄ±rga</option>
    <option>Burak Taygan</option>
    <option>BÃ¼ÅŸra</option>
    <option>Hakan</option>
    <option>Semih</option>
    <option>Okan</option>
    <option>DoÄŸan</option>
    <option>Åeyda</option>
    <option>Fuat</option>
    <option>RÃ¼stem</option>
    <option>Ã–zge</option>
    <option>Gizem</option>
    <option>Erkan</option>
    <option>NeÅŸe</option>
    <option>BaÅŸak</option>
    <option>Umut</option>
    <option>Fatih</option>
  </select>

  <br><br>
  <button id="showResultBtn">Sonucu GÃ¶ster</button>

  <div id="result"></div>

  <button id="adminBtn" class="adminBtn">Admin: EÅŸleÅŸmeleri SÄ±fÄ±rla</button>
</div>

<script>
  // --- Ä°SÄ°M LÄ°STESÄ° ---
  const NAMES = [
    "Damla","BarÄ±ÅŸ","Burak KasÄ±rga","Burak Taygan","BÃ¼ÅŸra","Hakan","Semih","Okan",
    "DoÄŸan","Åeyda","Fuat","RÃ¼stem","Ã–zge","Gizem","Erkan","NeÅŸe","BaÅŸak",
    "Umut","Fatih"
  ];

  // --- DERANGEMENT (kimse kendini Ã§ekmesin) ---
  function createDerangement(list) {
    let arr = [...list];
    let shuffled = [...list];

    do {
      for (let i = shuffled.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
      }
    } while (arr.some((v,i) => v === shuffled[i]));

    let map = {};
    arr.forEach((name,i) => map[name] = shuffled[i]);
    return map;
  }

  // EÅŸleÅŸme tablosu yoksa oluÅŸtur
  if (!localStorage.getItem("MATCH_TABLE")) {
    localStorage.setItem("MATCH_TABLE", JSON.stringify(createDerangement(NAMES)));
  }

  let MATCH_TABLE = JSON.parse(localStorage.getItem("MATCH_TABLE"));

  // UNIQ kontrol iÃ§in kullanÄ±lan sonuÃ§lar
  if (!localStorage.getItem("USED_RESULTS")) {
    localStorage.setItem("USED_RESULTS", JSON.stringify({}));
  }

  let USED_RESULTS = JSON.parse(localStorage.getItem("USED_RESULTS"));

  // Cihaz kilidi
  let lockedUser = localStorage.getItem("LOCKED_USER");

  // --- SONUCU GÃ–STERME FONKSÄ°YONU ---
  async function showResult() {
    const user = document.getElementById("nameSelect").value;
    const result = document.getElementById("result");

    if (!user) {
      result.innerHTML = "LÃ¼tfen ismini seÃ§.";
      return;
    }

    // Cihaz kilitli ise engelle
    if (lockedUser && lockedUser !== user) {
      result.innerHTML = `Bu cihaz daha Ã¶nce <b>${lockedUser}</b> iÃ§in sonuÃ§ gÃ¶sterdi.`;
      return;
    }

    const match = MATCH_TABLE[user];

    // UNIQ kontrol
    if (USED_RESULTS[match] && USED_RESULTS[match] !== user) {
      result.innerHTML = `
        <b>Bu isim baÅŸka biri tarafÄ±ndan zaten Ã§ekildi.</b><br>
        Admin sÄ±fÄ±rlama yapana kadar iÅŸlem yapÄ±lamaz.
      `;
      return;
    }

    // Bu cihaz artÄ±k bu kullanÄ±cÄ±ya kitlendi
    lockedUser = user;
    localStorage.setItem("LOCKED_USER", user);

    // Sonucu kullanÄ±lanlar listesine ekle
    USED_RESULTS[match] = user;
    localStorage.setItem("USED_RESULTS", JSON.stringify(USED_RESULTS));

    // --- KULLANICIYA ANINDA GÃ–STER (GEÃ‡Ä°KME YOK) ---
    result.innerHTML = `ğŸ <b>${match}</b> ğŸ`;

    // --- GOOGLE SHEETS KAYDI ARKA PLANDA Ã‡ALIÅSIN ---
    const SHEETS_URL =
      "https://script.google.com/macros/s/AKfycby8iN2pbMKgv2-Zxepo2g_Nw0ldIEVUdjwD83OnNGux9Fxf6tphCB_usOt2ydJcdkoORQ/exec";

    fetch(`${SHEETS_URL}?isim=${encodeURIComponent(user)}&hediye=${encodeURIComponent(match)}`)
      .then(() => console.log("Sheets kaydÄ± tamam"))
      .catch(err => console.error("Sheets kaydÄ± hata:", err));
  }

  // --- ADMIN RESET ---
  function adminReset() {
    const pass = prompt("Admin ÅŸifresi:");
    if (pass !== "258963") {
      alert("HatalÄ± ÅŸifre!");
      return;
    }

    localStorage.removeItem("MATCH_TABLE");
    localStorage.removeItem("LOCKED_USER");
    localStorage.removeItem("USED_RESULTS");

    alert("EÅŸleÅŸmeler sÄ±fÄ±rlandÄ±.");
    location.reload();
  }

  // Buton dinleyicileri
  document.getElementById("showResultBtn").addEventListener("click", showResult);
  document.getElementById("adminBtn").addEventListener("click", adminReset);
</script>

</body>
</html>
    
  </body>
  
</html>
