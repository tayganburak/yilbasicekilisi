<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="UTF-8">
    <title>Untitled</title>
    

  </head>
    
  <body>
  <!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Yƒ±lba≈üƒ± √áekili≈üi</title>
  <style>
    body { font-family: Arial; background:#f2f2f2; display:flex; justify-content:center; padding:40px; }
    .box { background:white; padding:20px; border-radius:12px; width:360px; text-align:center; box-shadow:0 0 10px rgba(0,0,0,.1); }
    button { padding:10px 18px; border:none; border-radius:10px; background:#40916c; color:white; cursor:pointer; }
    .adminBtn { background:#6c757d; margin-top:20px; }
    #result { margin-top:20px; font-size:1.2rem; font-weight:bold; }
    select { width:100%; padding:10px; border-radius:8px; border:1px solid #ccc; }
  </style>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js" defer></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js" defer></script>
</head>

<body>
<div class="box">
  <h2>Yƒ±lba≈üƒ± √áekili≈üi</h2>
  <p>ƒ∞smini se√ß ve e≈üle≈ümeni g√∂r.</p>

  <select id="nameSelect">
    <option value="">ƒ∞smini se√ß</option>
    <option>Damla</option>
    <option>Barƒ±≈ü</option>
    <option>Burak Kasƒ±rga</option>
    <option>Burak Taygan</option>
    <option>B√º≈üra</option>
    <option>Hakan</option>
    <option>Semih</option>
    <option>Okan</option>
    <option>Doƒüan</option>
    <option>≈ûeyda</option>
    <option>Fuat</option>
    <option>R√ºstem</option>
    <option>√ñzge</option>
    <option>Gizem</option>
    <option>Erkan</option>
    <option>Ne≈üe</option>
    <option>Ba≈üak</option>
    <option>Fatih</option>
    <option>Umut</option>
  </select>

  <br><br>
  <button id="showResultBtn">Sonucu G√∂ster</button>

  <div id="result"></div>

  <button id="adminBtn" class="adminBtn">Admin: E≈üle≈ümeleri Sƒ±fƒ±rla</button>
</div>
<script type="module">
  // Import the functions you need from the SDKs you need
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
  import { getAnalytics } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-analytics.js";
  // TODO: Add SDKs for Firebase products that you want to use
  // https://firebase.google.com/docs/web/setup#available-libraries

  // Your web app's Firebase configuration
  // For Firebase JS SDK v7.20.0 and later, measurementId is optional
  const firebaseConfig = {
    apiKey: "AIzaSyCwhEDuHLFEqKXS0Nt2DOTxLpiqomDV3ZA",
    authDomain: "yilbasison.firebaseapp.com",
    projectId: "yilbasison",
    storageBucket: "yilbasison.firebasestorage.app",
    messagingSenderId: "548976271380",
    appId: "1:548976271380:web:815f2afc62dc9ae7b6c701",
    measurementId: "G-N8D8V7N1K8"
  };

  // Initialize Firebase
  const app = initializeApp(firebaseConfig);
  const analytics = getAnalytics(app);
</script>
<script>
  // --------------------------------------------------------
  // ƒ∞Sƒ∞M Lƒ∞STESƒ∞
  // --------------------------------------------------------
  const NAMES = [
    "Damla","Barƒ±≈ü","Burak Kasƒ±rga","Burak Taygan","B√º≈üra","Hakan","Semih","Okan",
    "Doƒüan","≈ûeyda","Fuat","R√ºstem","√ñzge","Gizem","Erkan","Ne≈üe","Ba≈üak"
  ];

  // --------------------------------------------------------
  // DERANGEMENT
  // --------------------------------------------------------
  function createDerangement(list) {
    let arr = [...list];
    let shuffled = [...list];

    do {
      for (let i = shuffled.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
      }
    } while (arr.some((v, i) => v === shuffled[i]));

    let map = {};
    arr.forEach((name, i) => map[name] = shuffled[i]);
    return map;
  }

  if (!localStorage.getItem("MATCH_TABLE")) {
    localStorage.setItem("MATCH_TABLE", JSON.stringify(createDerangement(NAMES)));
  }

  let MATCH_TABLE = JSON.parse(localStorage.getItem("MATCH_TABLE"));
  let lockedUser = localStorage.getItem("LOCKED_USER");


  // --------------------------------------------------------
  // SONUCU G√ñSTER
  // --------------------------------------------------------
  function showResult() {
    const user = document.getElementById("nameSelect").value;
    const result = document.getElementById("result");

    if (!user) {
      result.innerHTML = "L√ºtfen ismini se√ß.";
      return;
    }

    if (lockedUser && lockedUser !== user) {
      result.innerHTML = `Bu cihaz daha √∂nce <b>${lockedUser}</b> i√ßin kullanƒ±ldƒ±.`;
      return;
    }

    lockedUser = user;
    localStorage.setItem("LOCKED_USER", user);

    const match = MATCH_TABLE[user];

    db.collection("cekilis_sonuclari").doc(user).set({
      isim: user,
      hediyeVerdigi: match,
      zaman: Date.now()
    });

    result.innerHTML = `Bu yƒ±l hediye vereceƒüin ki≈üi:<br><br>üéÅ <b>${match}</b> üéÅ`;
  }


  // --------------------------------------------------------
  // ADMƒ∞N RESET
  // --------------------------------------------------------
  function adminReset() {
    const pass = prompt("Admin ≈üifresi:");

    if (pass !== "258963") {
      alert("Hatalƒ± ≈üifre!");
      return;
    }

    localStorage.removeItem("MATCH_TABLE");
    localStorage.removeItem("LOCKED_USER");

    alert("E≈üle≈ümeler sƒ±fƒ±rlandƒ±.");
    location.reload();
  }


  // --------------------------------------------------------
  // EVENT Lƒ∞STENER'LAR (ARTIK KESƒ∞N √áALI≈ûIYOR!)
  // --------------------------------------------------------
  document.getElementById("showResultBtn").addEventListener("click", showResult);
  document.getElementById("adminBtn").addEventListener("click", adminReset);

});
</script>

</body>
</html>
    
  </body>
  
</html>
